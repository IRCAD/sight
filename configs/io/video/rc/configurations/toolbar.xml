<!-- Standard video widget -->
<extension implements="sight::service::extension::AppConfig" >
    <id>sight::config::io::video::Toolbar</id>
    <parameters>
        <param name="camera" />
        <param name="frameTL" />

        <param name="TOOLBAR" />
        <param name="videoSupport" default="true" />

        <param name="cameraStartedChannelOut" default="cameraStartedChannelOut" />
        <param name="cameraStoppedChannelOut" default="cameraStoppedChannelOut" />
        <param name="notificationChannel" default="notificationChannel" />

        <param name="boolParameterChannelIn" default="boolParameterChannelIn" />
        <param name="boolParameterChannelOut" default="boolParameterChannelOut" />
        <param name="intParameterChannelIn" default="intParameterChannelIn" />
        <param name="intParameterChannelOut" default="intParameterChannelOut" />
        <param name="enumParameterChannelIn" default="enumParameterChannelIn" />
        <param name="enumParameterChannelOut" default="enumParameterChannelOut" />
        <param name="enumValuesParameterChannelOut" default="enumValuesParameterChannelOut" />

        <param name="videoPositionParameterIn" default="videoPositionParameterIn" />
        <param name="videoPositionParameterOut" default="videoPositionParameterOut" />
        <param name="videoDurationParameterOut" default="videoDurationParameterOut" />
    </parameters>
    <config>

        <object uid="${camera}" type="sight::data::Camera" src="ref" />
        <object uid="${frameTL}" type="sight::data::FrameTL" src="ref" />

        <service uid="containerViewSrv" type="sight::module::ui::base::SView" >
            <gui>
                <toolBar />
                <layout type="sight::ui::base::LineLayoutManager" >
                    <orientation value="horizontal" />
                </layout>
            </gui>
            <registry>
                <parent wid="${TOOLBAR}" />
                <toolBar sid="toolbarViewSrv" start="true" />
            </registry>
        </service>

        <service uid="videoSelectorSrv" type="sight::module::ui::qt::video::SCamera" >
            <inout key="camera" uid="${camera}" />
            <videoSupport>${videoSupport}</videoSupport>
        </service>

        <service uid="toolbarViewSrv" type="sight::module::ui::base::SToolBar" >
            <gui>
                <layout>
                    <editor/>
                    <menuItem name="Start" icon="sight::module::ui::flaticons/GreenStart.svg" shortcut="Space" />
                    <menuItem name="Pause" icon="sight::module::ui::flaticons/OrangePause.svg" shortcut="Space" />
                    <menuItem name="Play" icon="sight::module::ui::flaticons/GreenStart.svg" shortcut="Space" />
                    <menuItem name="Stop" icon="sight::module::ui::flaticons/RedStop.svg" />
                    <menuItem name="Loop" icon="sight::module::ui::flaticons/OrangeLoop.svg" style="check" />
                </layout>
            </gui>
            <registry>
                <editor sid="videoSelectorSrv" start="true" />
                <menuItem sid="startVideoAct" start="true" />
                <menuItem sid="pauseVideoAct" start="true" />
                <menuItem sid="resumeVideoAct" start="true" />
                <menuItem sid="stopVideoAct" start="true" />
                <menuItem sid="loopVideoAct" start="true" />
            </registry>
        </service>

        <service uid="grabberProxySrv" type="sight::module::io::video::SGrabberProxy" >
            <in key="camera" uid="${camera}" />
            <inout key="frameTL" uid="${frameTL}" />
        </service>

        <!-- ******************************* Actions ****************************** -->

        <!-- Start the frame grabber -->
        <service uid="startVideoAct" type="sight::module::ui::base::SAction" />

        <!-- Pause the frame grabber -->
        <service uid="pauseVideoAct" type="sight::module::ui::base::SAction" >
            <state visible="false" />
        </service>

        <!-- Resume the frame grabber -->
        <service uid="resumeVideoAct" type="sight::module::ui::base::SAction" >
            <state visible="false" />
        </service>

        <!-- Stop the frame grabber -->
        <service uid="stopVideoAct" type="sight::module::ui::base::SAction" >
            <state enabled="false" />
        </service>

        <!-- Loop the frame grabber -->
        <service uid="loopVideoAct" type="sight::module::ui::base::SAction" >
            <state enabled="false" />
        </service>

        <!-- ******************************* Connections ******************************* -->

        <connect>
            <signal>startVideoAct/clicked</signal>
            <slot>grabberProxySrv/startCamera</slot>
        </connect>

        <connect>
            <signal>pauseVideoAct/clicked</signal>
            <slot>grabberProxySrv/pauseCamera</slot>
            <slot>resumeVideoAct/show</slot>
            <slot>pauseVideoAct/hide</slot>
        </connect>

        <connect>
            <signal>resumeVideoAct/clicked</signal>
            <slot>grabberProxySrv/pauseCamera</slot>
            <slot>resumeVideoAct/hide</slot>
            <slot>pauseVideoAct/show</slot>
        </connect>

        <connect>
            <signal>stopVideoAct/clicked</signal>
            <slot>grabberProxySrv/stopCamera</slot>
            <slot>startVideoAct/show</slot>
            <slot>resumeVideoAct/hide</slot>
            <slot>pauseVideoAct/hide</slot>
            <slot>stopVideoAct/disable</slot>
            <slot>loopVideoAct/disable</slot>
            <slot>loopVideoAct/uncheck</slot>
        </connect>

        <connect>
            <signal>loopVideoAct/clicked</signal>
            <slot>grabberProxySrv/loopVideo</slot>
        </connect>

        <connect>
            <signal>videoSelectorSrv/configuredCameras</signal>
            <slot>grabberProxySrv/reconfigure</slot>
        </connect>

        <connect>
            <signal>videoSelectorSrv/configuredFile</signal>
            <signal>videoSelectorSrv/configuredStream</signal>
            <signal>videoSelectorSrv/configuredDevice</signal>
            <slot>startVideoAct/update</slot>
        </connect>

        <connect channel="${cameraStartedChannelOut}" >
            <signal>grabberProxySrv/cameraStarted</signal>
            <slot>pauseVideoAct/show</slot>
            <slot>startVideoAct/hide</slot>
            <slot>stopVideoAct/enable</slot>
            <slot>loopVideoAct/enable</slot>
        </connect>

        <connect>
            <signal>camera/idModified</signal>
            <slot>grabberProxySrv/stopCamera</slot>
        </connect>

        <connect channel="${cameraStoppedChannelOut}" >
            <signal>grabberProxySrv/cameraStopped</signal>
        </connect>

        <connect>
            <signal>camera/modified</signal>
            <slot>startVideoAct/enable</slot>
            <slot>stopVideoAct/update</slot>
        </connect>

        <connect channel="${boolParameterChannelIn}" >
            <slot>grabberProxySrv/setBoolParameter</slot>
        </connect>

        <connect channel="${boolParameterChannelOut}" >
            <signal>grabberProxySrv/boolChanged</signal>
        </connect>

        <connect channel="${intParameterChannelIn}">
            <slot>grabberProxySrv/setIntParameter</slot>
        </connect>

        <connect channel="${intParameterChannelOut}">
            <signal>grabberProxySrv/intChanged</signal>
        </connect>

        <connect channel="${enumParameterChannelIn}">
            <slot>grabberProxySrv/setEnumParameter</slot>
        </connect>

        <connect channel="${enumParameterChannelOut}">
            <signal>grabberProxySrv/enumChanged</signal>
        </connect>

        <connect channel="${enumValuesParameterChannelOut}">
            <signal>grabberProxySrv/enumValuesChanged</signal>
        </connect>

        <connect channel="${videoPositionParameterIn}">
            <slot>grabberProxySrv/setPositionVideo</slot>
        </connect>

        <connect channel="${videoPositionParameterOut}">
            <signal>grabberProxySrv/positionModified</signal>
        </connect>

        <connect channel="${videoDurationParameterOut}">
            <signal>grabberProxySrv/durationModified</signal>
        </connect>

        <connect channel="${notificationChannel}">
            <signal>grabberProxySrv/notified</signal>
        </connect>

        <start uid="containerViewSrv" />
        <start uid="grabberProxySrv" />

    </config>
</extension>
